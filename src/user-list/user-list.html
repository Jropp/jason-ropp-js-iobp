<link rel="import" href="polymer.html">
<link rel="import" href="user-component.html">
<dom-module id="user-list">
  <template>
    <style>
      :host {
        display: block;
        padding: 10px;
      }

      .default-card {
        background-color: #B1A296;
        width: 300px;
        padding: 10px;
        margin: 10px;
        border-radius: 5px;
        box-shadow: 3px 3px 2px black;
        height: 50px;
      }

      .default-card:hover {
        height: 230px;
        transition: height .4s ease-out;
      }

      .default-card:not(:hover) {
        height: 50px;
        transition: height .4s ease-in;
      }

      .default-card:hover>h3 {
        opacity: 1;
        transition: opacity 1.4s;
      }

      hgroup>h3 {
        opacity: 0;
      }

      button {
        background-color: #7395AE;
        color: black;
        border: none;
        height: 40px;
        border-radius: 3px;
      }
    </style>
    <template is="dom-if" if="[[isMode(mode, modes.DISPLAY)]]">
      <button on-click="createNewUserCard">+ Create New User</button>
    </template>
    <template is="dom-if" if="[[isMode(mode, modes.CREATE_NEW)]]">
      <template is="dom-if" if="[[!users]]">
        <h2>There are currently no users in the database. Please create one.</h2>
      </template>
      <user-component mode="edit"></user-component>
    </template>
    <template is="dom-if" if="[[isMode(mode, modes.DISPLAY)]]">
      <template is="dom-repeat" items="[[users]]" as="user">
        <user-component mode="display" user="[[user]]">
        </user-component>
      </template>
    </template>

  </template>
  <script>
    'use strict';
    class UserListElement extends Polymer.Element {
      static get is() { return 'user-list'; }
      static get properties() {
        return {
          users: {
            type: Array,
            value: () => JSON.parse(localStorage.getItem('onboardProjectUsers'))
          },
          mode: {
            type: String,
          },
          modes: {
            type: Object,
            value: () => {
              return {
                CREATE_NEW: 'create',
                DISPLAY: 'display'
              };
            }
          },
        };
      }
      connectedCallback() {
        super.connectedCallback();
        if (!this.users || !this.users.length) {
          this.users = false;
          this.mode = this.modes.CREATE_NEW;
        } else {
          this.mode = this.modes.DISPLAY;
        }

        document.addEventListener('cancel create new user', () => {
          this.mode = this.modes.DISPLAY;
        });

      }
      isMode(currentMode, expectedMode) {
        return (currentMode === expectedMode);
      }
      createNewUserCard() {
        this.mode = this.modes.CREATE_NEW;
      }
    }

    customElements.define(UserListElement.is, UserListElement);
  </script>
</dom-module>
