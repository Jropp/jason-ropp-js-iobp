<!-- bplint-disable no-unused-import -->
<link rel="import" href="~@banno/polymer/lib/elements/dom-if.js">
<link rel="import" href="~@banno/polymer/lib/elements/dom-repeat.js">
<link rel="import" href="~@banno/polymer/polymer-element.js">
<!-- <link rel="import" href="./main.js"> -->
<!-- bplint-enable no-unused-import -->
<link rel="import" href="../user-component/user-component.html">
<dom-module id="user-list">
  <template>
    <style>
      :host {
        display: block;
        padding: 10px;
      }

      .default-card {
        background-color: #B1A296;
        width: 300px;
        padding: 10px;
        margin: 10px;
        border-radius: 5px;
        box-shadow: 3px 3px 2px black;
        height: 50px;
      }

      .default-card:hover {
        height: 230px;
        transition: height .4s ease-out;
      }

      .default-card:not(:hover) {
        height: 50px;
        transition: height .4s ease-in;
      }

      .default-card:hover>h3 {
        opacity: 1;
        transition: opacity 1.4s;
      }

      hgroup>h3 {
        opacity: 0;
      }

      button {
        background-color: #7395AE;
        color: black;
        border: none;
        height: 40px;
        border-radius: 3px;
      }

      .display-container {
        display: grid;
        grid-template-columns: 50fr 50fr;
      }

      .create-user-component {
        position: fixed;
      }
    </style>
    <div class="display-container">

      <div class="user-list-column">
        <template is="dom-if" if="[[checkForUsers(users)]]">
          <h2>There are currently no users in the database. Please create one.</h2>
        </template>
        <template is="dom-repeat" items="[[users]]" as="user">
          <user-component disable-edit="[[disableFunctionality]]" mode="display" user="[[user]]"></user-component>
        </template>
      </div>

      <div class="new-user-column">
        <div class="create-user-component">
          <template is="dom-if" if="[[isMode(mode, modes.DISPLAY)]]">
            <button on-click="showCreateNewUserCard">+ Create New User</button>
          </template>
          <template is="dom-if" if="[[isMode(mode, modes.CREATE_NEW)]]">
            <user-component disable-save="[[disableFunctionality]]" mode="edit"></user-component>
          </template>
        </div>
      </div>
    </div>

  </template>
  <script type="module">
    import { Element as PolymerElement } from '@banno/polymer/polymer-element.js'; // eslint-disable-line no-unused-vars

    import { database } from './../api/user-database.js';
    class UserListElement extends PolymerElement {
      static get is() { return 'user-list'; }
      static get properties() {
        return {
          disableFunctionality: {
            type: Boolean,
            value: false
          },
          users: {
            type: Array,
            value: () => database.getUsers()
          },
          mode: {
            type: String,
          },
          modes: {
            type: Object,
            value: () => {
              return {
                CREATE_NEW: 'create',
                DISPLAY: 'display'
              };
            }
          },
        };
      }
      connectedCallback() {
        super.connectedCallback();

        this.mode = (this.users.length) ? this.modes.DISPLAY : this.modes.CREATE_NEW;

        document.addEventListener('cancel', () => {
          this.mode = this.modes.DISPLAY;
        });

        document.addEventListener('delete', (e) => {
          database.deleteUser(e.detail.user);
          this.updateUserList();
          this.disableFunctionality = false;
        });

        document.addEventListener('save', (e) => {
          this.saveNewOrUpdate(e.detail.user);
          this.disableFunctionality = false;
        });

        document.addEventListener('edit', () => {
          this.disableFunctionality = true;
        });
      }

      saveNewOrUpdate(user) {
        const isExistingUser = user.id;
        if (isExistingUser) {
          debugger;
          database.editUser(user);
        } else {
          debugger;
          database.saveUser(user);
        }
        this.updateUserList();
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        document.removeEventListener('cancel');
        document.removeEventListener('delete');
        document.removeEventListener('save');
        document.removeEventListener('edit');
      }

      isMode(currentMode, expectedMode) {
        return (currentMode === expectedMode);
      }

      showCreateNewUserCard() {
        this.mode = this.modes.CREATE_NEW;
        this.disableEdit = true;
      }

      updateUserList() {
        this.users = database.getUsers();
      }

      checkForUsers(users) {
        return users.length === 0;
      }

    }

    customElements.define(UserListElement.is, UserListElement);
    export default UserListElement;
  </script>
</dom-module>
