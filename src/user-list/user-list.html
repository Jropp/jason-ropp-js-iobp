<!-- bplint-disable no-unused-import -->
<link rel="import" href="~@banno/polymer/lib/elements/dom-if.js">
<link rel="import" href="~@banno/polymer/lib/elements/dom-repeat.js">
<!-- bplint-enable no-unused-import -->
<link rel="import" href="../user-component/user-component.html">
<dom-module id="user-list">
  <template>
    <style>
      :host {
        display: block;
        background-color: #e4e7ea;
      }

      button {
        height: 52px;
        width: 32%;
        border: none;
        border-radius: 3px;
        color: black;
        background-color: #fca902;
      }

      .columns {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
      }

      .user-list-row {
        text-align: center;
        margin-top: 18px;
      }

      .create-user {
        font-size: 15px;
        transition: opacity .4s linear;
      }

      .card-container {
        display: flex;
        flex-direction: column;
      }

      .message-box {
        background-color: #4caf50;
        color: #eef1f4;
        position: fixed;
        bottom: 10px;
        left: 10px;
        font-family: Helvetica;
        font-size: 17px;
        height: auto;
        width: 15%;
        margin: 20px;
        padding: 10px;
        text-align: center;
        opacity: 0;
        transform: translateY(100%);
        transition: all 600ms cubic-bezier(0.77, 0, 0.175, 1);
      }

      .show-message {
        transform: none;
        opacity: 0.9;
      }

      .create-user.visible {
        opacity: 1;
        visibility: visible;
      }

      .create-user.hidden {
        opacity: 0;
        visibility: hidden;
      }
    </style>
    <div class="columns">
      <div class="column-1">
        <h2 id="popupBox" class="message-box">Save</h2>
      </div>
      <div class="card-container column-2">
        <div class="create-user-row">
          <user-component class="new-user-card" edit-open="[[editInProgress]]" mode="edit"></user-component>
        </div>
        <div class="user-list-row">
          <template is="dom-if" if="[[noUsersHeaderMessage(users)]]">
            <h2>There are currently no users in the database. Please create one.</h2>
          </template>
          <template is="dom-repeat" items="[[users]]" as="user">
            <user-component edit-open="[[editInProgress]]" mode="display" user-to-display="[[user]]"></user-component>
          </template>
        </div>
      </div>
      <div class="colum-3"></div>
    </div>

  </template>
  <script type="module">
    import { Element as PolymerElement } from '@banno/polymer/polymer-element.js'; // eslint-disable-line no-unused-vars

    import { database } from './../api/user-database.js';
    class UserListElement extends PolymerElement {
      static get is() { return 'user-list'; }
      static get properties() {
        return {
          editInProgress: {
            type: Boolean,
            value: false
          },
          users: {
            type: Array,
            value: () => database.getUsers()
          },
          mode: {
            type: String,
          },
          expandNewUserCard: {
            type: Boolean,
          },
          modes: {
            type: Object,
            value: () => {
              return {
                CREATE_NEW: 'create',
                DISPLAY: 'display'
              };
            }
          },
        };
      }
      connectedCallback() {
        super.connectedCallback();

        this.initMode();

        document.addEventListener('cancel', () => {
          this.toggleMode();
        });

        document.addEventListener('databaseUpdated', e => {
          this.users = database.getUsers();
          this.popupMessage(e.detail.message);
        });

        document.addEventListener('editInProgress', e => {
          this.editInProgress = e.detail;
        });

      }

      disconnectedCallback() {
        super.disconnectedCallback();
        document.removeEventListener('editInProgress');
        document.removeEventListener('databaseUpdated');
        document.removeEventListener('cancel');
      }

      initMode() {
        this.mode = this.users.length ? this.modes.DISPLAY : this.modes.CREATE_NEW;
      }

      isMode(expectedMode) {
        return expectedMode === this.mode;
      }

      noUsersHeaderMessage(users) {
        return !users.length;
      }

      popupMessage(action) {
        let animationTime = 3000;
        let messageBox = this.$.popupBox;
        messageBox.textContent = action + ' Successful';
        messageBox.className = 'message-box show-message ' + action;
        window.setTimeout(() => {
          messageBox.className = 'message-box';
        }, animationTime);
      }

      toggleMode() {
        this.expandNewUserCard = !this.isMode(this.modes.CREATE_NEW);
        this.mode = this.isMode(this.modes.CREATE_NEW) ? this.modes.DISPLAY : this.modes.CREATE_NEW;
        this.$.newUserButton.className = this.isMode(this.modes.DISPLAY) ? 'create-user visible' : 'create-user hidden';
      }

    }

    customElements.define(UserListElement.is, UserListElement);
    export default UserListElement;
  </script>
</dom-module>
